if(null===document.getElementById("md-ImgViewer-style")){const e=document.createElement("style");e.setAttribute("id","md-ImgViewer-style"),e.setAttribute("type","text/css"),e.innerHTML=".md-spinner{width:60px;height:60px;position:absolute;top:calc((100% - 60px)/ 2);left:calc((100% - 60px)/ 2);z-index:999}.md-spinner-b1,.md-spinner-b2{width:100%;height:100%;border-radius:50%;background-color:#fff;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:sk-bounce 2s infinite ease-in-out;animation:sk-bounce 2s infinite ease-in-out}.md-spinner-b2{-webkit-animation-delay:-1s;animation-delay:-1s}@-webkit-keyframes sk-bounce{0%,100%{-webkit-transform:scale(0)}50%{-webkit-transform:scale(1)}}@keyframes sk-bounce{0%,100%{transform:scale(0);-webkit-transform:scale(0)}50%{transform:scale(1);-webkit-transform:scale(1)}}.md-spinner{display:none}.md-loadingImg+.md-spinner{display:block}#md-media-viewer{display:none;position:fixed;top:0;left:0;z-index:998;width:auto;height:100vh;margin:0!important;padding:0!important;background:#14171a77;will-change:background;transition-property:background;transition-duration:.2s}#md-media-viewer.md-swipeY{background:#0000}.md-img-container,.md-media-container{width:100%;height:100%}.md-img-container{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;overflow-x:scroll;will-change:transform;transition-property:transform}.md-smooth{transition:.12s linear}.md-swipeClose{transition:.2s linear}.md-img-item{position:relative;width:100vw;height:100%;min-width:100vw;min-height:100%}.md-img{width:100%;height:100%;object-fit:contain;transform:scale(1);will-change:transform;transition:.2s}.md-img.md-dragging,.md-img.md-pinchInOut{transition:0s}.md-button{position:fixed;top:13px;right:13px;z-index:99;width:40px;height:40px;margin:0;padding:0;line-height:35px;text-align:center;background-color:#00000090;border-radius:50%;transform:rotate(90deg)}.md-button>i{width:40px!important;height:40px!important;line-height:37px!important;font-size:30px!important;vertical-align:unset!important;color:#ffffffc4}.md-dropdown-menu{position:fixed;top:13px;right:13px;z-index:100;width:140px;height:50px;border-radius:7px;overflow:hidden;transition:.2s}html .md-dropdown-menu{background-color:#fff;box-shadow:0 1px 7px -1px #00000050}html .md-dropdown-menu>li:active+html .md-dropdown-menu,html .md-dropdown-menu>li:hover+html .md-dropdown-menu{background-color:#fff}html.dark .md-dropdown-menu{background-color:#222;box-shadow:0 1px 7px -1px #000000a1}html.dark .md-dropdown-menu>li:active+html.dark .md-dropdown-menu,html.dark .md-dropdown-menu>li:hover+html.dark .md-dropdown-menu{background-color:#fff}.md-dropdown-menu>li{width:100%;height:40px;line-height:40px;text-align:center;margin:5px 0!important;user-select:none;transition:.1s}html .md-dropdown-menu>li{color:#333}html.dark .md-dropdown-menu>li{color:#fff}.md-closeMenu,.md-swipeY .md-dropdown-menu{width:0;height:0}",document.head.appendChild(e)}function addMediaViewer(){if(!document.getElementById("md-media-viewer")){const e=document.createElement("div");return e.setAttribute("id","md-media-viewer"),e.setAttribute("style","display: none;"),e.insertAdjacentHTML("beforeend",'<div class="md-media-container"><div class="md-img-container"></div></div><div class="md-button-container"><div class="md-button" md-jsaction="menu"><i class="icon icon-more"></i></div><ul class="md-dropdown-menu md-closeMenu"><li md-jsaction="save">保存</li></ul></div>'),e.addEventListener("touchstart",fncTouchStart,{passive:!1}),e.addEventListener("touchmove",fncTouchMove,{passive:!1}),e.addEventListener("touchend",fncTouchEnd,{passive:!1}),document.body.appendChild(e)}}addMediaViewer();let target,imgContainer,startPoint,startTime,movePoint,urlLength=1;function openImageViewer(e,t){if(0===(urlLength=e.length))return;maxTransX=window.innerWidth*(urlLength-1)*-1,mediaViewer=document.getElementById("md-media-viewer"),mediaViewer||(mediaViewer=addMediaViewer());const n=mediaViewer.querySelector(".md-img-container");for(;n.firstChild;)n.removeChild(n.firstChild);for(let t=0;t<urlLength;t++){const i=document.createElement("img");i.classList.add("md-img","md-loadingImg"),i.src=e[t],i.addEventListener("load",e=>{e.target.classList.remove("md-loadingImg")});const a=document.createElement("div");a.classList.add("md-img-item"),a.appendChild(i),a.insertAdjacentHTML("beforeend",'<div class="md-spinner"><div class="md-spinner-b1"></div><div class="md-spinner-b2"></div></div>'),n.appendChild(a)}const i=window.innerWidth*t*-1;n.style.transform=`translate3d(${i}px, 0px, 0px)`,"block"!==document.getElementById("open-modal").style.display&&setTimeout(()=>{const e=document.getElementById("open-modal");for(;e.firstChild;)e.removeChild(e.firstChild);e.style.display="none"},0),mediaViewer.style.display="block"}function closeImageViewer(){const e=document.getElementById("md-media-viewer");if(!e)return;e.style.display="none",e.classList.remove("md-swipeY");const t=e.querySelector(".md-img-container");if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function changeImgSize(e,t){if(e&&t)return e.replace(/&name=.+/,`&name=${t}`)}function getDirection(e,t){const n=e.x,i=e.y,a=t.x,r=t.y;return Math.abs(r-i)<=Math.abs(a-n)?n<a?-1:-2:i<r?2:1}function getTranslate3d(){let e=document.getElementsByClassName("md-img-container")[0].style.transform.match(/[-|\d|\.]+px/g);if(e){for(let t=0;t<e.length;t++)e[t]=parseFloat(e[t].replace("px",""));return e}}function getDistance(e,t){const n=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);return n*n+i*i}document.body.addEventListener("click",e=>{const t=e.target,n=t.closest("div.media-preview"),i=t.closest("div.md-prf");if(!n&&!i)return;let a=[],r=0;try{if(n){const e=n.querySelectorAll('a[rel="mediaPreview"]');if(!e)return;if(1===e.length){let t;e[0].removeAttribute("href"),t=changeImgSize(t=e[0].children.length>0?e[0].children[0].src.match(/(https:.+format=.+)/)[1]:e[0].style.backgroundImage.match(/url\(\"(https:.+format=.+)\"\)/)[1],"large"),a.push(t)}else for(let n=0;n<e.length;n++){e[n].removeAttribute("href");let i=e[n].style.backgroundImage.match(/url\(\"(https:.+format=.+)\"\)/)[1];i=changeImgSize(i,"large"),a.push(i),e[n]===t&&(r=n)}}else if(i){let e;e=t.classList.contains("avatar")?t.src.replace(/(https:\/\/pbs.twimg.com\/profile_images\/\w+\/.{8})_[^\.]+\.(\w+)/,"$1.$2"):t.src.replace(/(https:\/\/pbs.twimg.com\/profile_banners\/\w+\/\w+)\/.+/,"$1"),a.push(e)}openImageViewer(a,r)}catch(e){console.log(e)}},{passive:!0});let swipeDir,translate3d,nowTranslateX,nowTranslateY,maxTransX,isDefScale=!0;function fncTouchStart(e){if(e.preventDefault(),target=e.target,!(imgContainer=document.getElementsByClassName("md-img-container")[0]))return;const t=e.touches;startPoint={x:t[0].pageX,y:t[0].pageY},movePoint=startPoint,startTime=new Date,translate3d=getTranslate3d()}function fncTouchMove(e){if(e.preventDefault(),!imgContainer)return;const t=e.touches;1===t.length&&(movePoint={x:t[0].pageX,y:t[0].pageY},isDefScale?swipeDir?swipeDir<0?((nowTranslateX=translate3d[0]+(movePoint.x-startPoint.x))>0&&(nowTranslateX=0),maxTransX>nowTranslateX&&(nowTranslateX=maxTransX),imgContainer.style.transform=`translate3d(${nowTranslateX}px, ${translate3d[1]}px, 0px)`):(mediaViewer.classList.add("md-swipeY"),nowTranslateY=translate3d[1]+(movePoint.y-startPoint.y),imgContainer.style.transform=`translate3d(${translate3d[0]}px, ${nowTranslateY}px, 0px)`):20<getDistance(startPoint,movePoint)&&(swipeDir=getDirection(startPoint,movePoint),imgContainer.classList.remove("md-smooth")):console.log("ズーム中"))}function fncTouchEnd(e){e.preventDefault();const t=new Date-startTime,n=Math.sqrt(getDistance(startPoint,movePoint))/(t/1e3);if(t<200&&n>1e3)if(imgContainer.classList.add("md-smooth"),swipeDir<0){let e=imgContainer.getElementsByClassName("md-img");const t=(e=[].slice.call(e)).indexOf(target);-2===swipeDir?t<urlLength-1&&(imgContainer.style.transform=`translate3d(${window.innerWidth*(t+1)*-1}px, ${translate3d[1]}px, 0px)`):t>0&&(imgContainer.style.transform=`translate3d(${window.innerWidth*(t-1)*-1}px, ${translate3d[1]}px, 0px)`)}else setTimeout(closeImageViewer,200),imgContainer.style.transform=1===swipeDir?`translate3d(${translate3d[0]}px, ${-1*window.innerHeight-5}px, 0px)`:`translate3d(${translate3d[0]}px, ${window.innerHeight+5}px, 0px)`;else if(swipeDir<0){const e=.5*window.innerWidth,t=-1*window.innerWidth;for(let n=1;n<=urlLength;n++){const i=t*n+e;if(i<nowTranslateX){imgContainer.classList.add("md-smooth"),imgContainer.style.transform=`translate3d(${i+e}px, ${translate3d[1]}px, 0px)`;break}}}else if(swipeDir>0){imgContainer.classList.add("md-smooth");const e=.5*window.innerHeight;-1*e<nowTranslateY&&nowTranslateY<e?(mediaViewer.classList.remove("md-swipeY"),imgContainer.style.transform=`translate3d(${translate3d[0]}px, 0px, 0px)`):(setTimeout(closeImageViewer,200),imgContainer.style.transform=e<=nowTranslateY?`translate3d(${translate3d[0]}px, ${window.innerHeight+5}px, 0px)`:`translate3d(${translate3d[0]}px, ${-1*window.innerHeight-5}px, 0px)`)}target=null,imgContainer=null,movePoint=null,startPoint=null,startTime=null,swipeDir=null,translate3d=null}
