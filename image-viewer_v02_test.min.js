if(null===document.getElementById("md-ImgViewer-style")){const e=document.createElement("style");e.setAttribute("id","md-ImgViewer-style"),e.setAttribute("type","text/css"),e.innerHTML=".md-spinner{width:60px;height:60px;position:absolute;top:calc((100% - 60px)/ 2);left:calc((100% - 60px)/ 2);z-index:999}.md-spinner-b1,.md-spinner-b2{width:100%;height:100%;border-radius:50%;background-color:#fff;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:sk-bounce 2s infinite ease-in-out;animation:sk-bounce 2s infinite ease-in-out}.md-spinner-b2{-webkit-animation-delay:-1s;animation-delay:-1s}@-webkit-keyframes sk-bounce{0%,100%{-webkit-transform:scale(0)}50%{-webkit-transform:scale(1)}}@keyframes sk-bounce{0%,100%{transform:scale(0);-webkit-transform:scale(0)}50%{transform:scale(1);-webkit-transform:scale(1)}}.md-spinner{display:none}.md-loadingImg+.md-spinner{display:block}#md-media-viewer{display:none;position:fixed;top:0;left:0;z-index:998;width:auto;height:100vh;margin:0!important;padding:0!important;background:#14171a77;overflow:hidden;will-change:background;transition-property:background;transition-duration:.2s}#md-media-viewer.md-swipeY{background:#0000}.md-img-container,.md-media-container{width:100%;height:100%}.md-img-container{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;overflow:hidden;will-change:transform;transition-property:transform}.md-smooth{transition:.13s cubic-bezier(.4,0,.2,1)}.md-smooth-pc{transition:.5s cubic-bezier(.4,0,.2,1)}.md-swipeClose{transition:.2s cubic-bezier(.4,0,.2,1)}.md-img-item{position:relative;width:100vw;height:100%;min-width:100vw;min-height:100%;will-change:transform;transition:.2s}.md-img-item.md-dragging,.md-img-item.md-pinchInOut{transition:0s}.md-img{width:100%;height:100%;object-fit:contain;will-change:transform;transition:.2s}.md-img.md-dragging,.md-img.md-pinchInOut{transition:0s}.md-button{cursor:pointer}.md-btnCir{position:fixed;z-index:99;width:40px;height:40px;margin:0;padding:0;line-height:40px;text-align:center;background-color:#00000090;border-radius:50%;transition:.2s}.md-button[md-jsaction=menu]{display:none;top:13px;right:13px;transform:rotate(90deg)}.md-button[md-jsaction=next]{top:calc((100% - 40px)/ 2);right:13px}.md-button[md-jsaction=prev]{top:calc((100% - 40px)/ 2);left:13px}.md-button[md-jsaction=close]{top:13px;left:13px;background-color:#0000}.md-button[md-jsaction=close]:hover{background-color:#00000090}.md-button.md-btnHide{display:none!important}.md-btnCir>i{width:40px!important;height:40px!important;line-height:40px!important;font-size:30px!important;vertical-align:unset!important;color:#ffffffc4}.md-btnCir[md-jsaction=close]>i,.md-btnCir[md-jsaction=menu]>i{line-height:37px!important}.md-dropdown-menu{position:fixed;top:13px;right:13px;z-index:100;width:140px;height:50px;border-radius:7px;overflow:hidden;transition:.2s}html .md-dropdown-menu{background-color:#fff;box-shadow:0 1px 7px -1px #00000050}html.dark .md-dropdown-menu{background-color:#222;box-shadow:0 1px 7px -1px #000000a1}.md-dropdown-menu>li{width:100%;height:40px;line-height:40px;text-align:center;margin:5px 0!important;user-select:none;cursor:pointer;transition:.3s}html .md-dropdown-menu>li{color:#333}html.dark .md-dropdown-menu>li{color:#fff}html .md-dropdown-menu>li:active{background-color:#00000013}html.dark .md-dropdown-menu>li:active{background-color:#ffffff13}.md-closeMenu,.md-swipeY .md-dropdown-menu{width:0;height:0}.md-ua-smp .md-button[md-jsaction=menu]{display:block}.md-ua-smp .md-button[md-jsaction=close],.md-ua-smp .md-button[md-jsaction=next],.md-ua-smp .md-button[md-jsaction=prev]{display:none}",document.head.appendChild(e)}function addMediaViewer(){if(!document.getElementById("md-media-viewer")){const e=document.createElement("div");return e.setAttribute("id","md-media-viewer"),e.setAttribute("style","display: none;"),e.insertAdjacentHTML("beforeend",'<div class="md-media-container"><div class="md-img-container"></div></div><div class="md-button-container"><div class="md-button md-btnCir" md-jsaction="menu"><i class="icon icon-more"></i></div><ul class="md-dropdown-menu md-closeMenu"><li class="md-button md-btnSqr" md-jsaction="save">保存</li></ul><div class="md-button md-btnCir" md-jsaction="next"><i class="icon icon-arrow-r"></i></div><div class="md-button md-btnCir" md-jsaction="prev"><i class="icon icon-arrow-l"></i></div><div class="md-button md-btnCir" md-jsaction="close"><i class="icon icon-close"></i></div></div>'),e.addEventListener("click",fncClick,{passive:!1}),e.addEventListener("wheel",fncWheel,{passive:!1}),e.addEventListener("touchstart",fncTouchStart,{passive:!1}),e.addEventListener("touchmove",fncTouchMove,{passive:!1}),e.addEventListener("touchend",fncTouchEnd,{passive:!1}),document.body.appendChild(e)}}let mediaViewer,imgContainer,nowIndex,targetImg,targetInfo,imgItem,startPoint,startTime,movePoint,swipeDir,cTranslate3d,iTranslate3d,cTranslateX,cTranslateY,iTranslateX,iTranslateY,maxTransX,urlLength=1;function openImageViewer(e,t){if(0===(urlLength=e.length))return;for(maxTransX=window.innerWidth*(urlLength-1)*-1,nowIndex=t,mediaViewer||(mediaViewer=addMediaViewer()),navigator.userAgent.match(/(iPhone|iPad|iPod|Android)/i)?mediaViewer.classList.add("md-ua-smp"):mediaViewer.classList.remove("md-ua-smp"),imgContainer=mediaViewer.querySelector("div.md-img-container");imgContainer.firstChild;)imgContainer.removeChild(imgContainer.firstChild);for(let t=0;t<urlLength;t++){const n=document.createElement("img");n.classList.add("md-img","md-loadingImg"),n.style.transform="scale(1) translate3d(0px, 0px, 0px)",n.src=e[t],n.addEventListener("load",e=>{e.target.classList.remove("md-loadingImg")});const i=document.createElement("div");i.classList.add("md-img-item"),i.appendChild(n),i.insertAdjacentHTML("beforeend",'<div class="md-spinner"><div class="md-spinner-b1"></div><div class="md-spinner-b2"></div></div>'),imgContainer.appendChild(i)}const n=window.innerWidth*t*-1;imgContainer.style.transform=`translate3d(${n}px, 0px, 0px)`;const i=mediaViewer.querySelector('div.md-button[md-jsaction="next"]'),a=mediaViewer.querySelector('div.md-button[md-jsaction="prev"]');i&&a&&(i.classList.remove("md-btnHide"),a.classList.remove("md-btnHide"),urlLength<=1?(i.classList.add("md-btnHide"),a.classList.add("md-btnHide")):t<=0?a.classList.add("md-btnHide"):urlLength-1<=t&&i.classList.add("md-btnHide")),"block"!==document.getElementById("open-modal").style.display&&setTimeout(()=>{const e=document.getElementById("open-modal");for(;e.firstChild;)e.removeChild(e.firstChild);e.style.display="none"},0),mediaViewer.style.display="block"}function closeImageViewer(){const e=document.getElementById("md-media-viewer");if(!e)return;e.style.display="none",e.classList.remove("md-swipeY");const t=e.querySelector(".md-img-container");if(!t)return;for(;t.firstChild;)t.removeChild(t.firstChild);e.classList.remove("md-swipeY");const n=mediaViewer.querySelector("ul.md-dropdown-menu");n&&n.classList.add("md-closeMenu")}function changeImgSize(e,t){if(e&&t)return e.replace(/&name=.+/,`&name=${t}`)}function getDirection(e,t){const n=e.x,i=e.y,a=t.x,o=t.y;return Math.abs(o-i)<=Math.abs(a-n)?n<a?-1:-2:i<o?2:1}function getTranslate3d(e){try{let t=e.style.transform.match(/[-|\d|\.]+px/g);if(t){for(let e=0;e<t.length;e++)t[e]=parseFloat(t[e].replace("px",""));return t}}catch(e){}}function getDistance(e,t){const n=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);return n*n+i*i}function scrollImg(e){try{const t=window.innerWidth*e*-1;imgContainer.style.transform=`translate3d(${t}px, 0px, 0px)`,cTranslate3d=[t,0,0]}catch(e){}}function scrollImgNext(e){if(1!==urlLength){const e=mediaViewer.querySelector('div.md-button[md-jsaction="prev"]');e&&e.classList.remove("md-btnHide")}if(nowIndex<urlLength-1&&(imgContainer.classList.remove(`md-smooth${e?"":"-pc"}`),imgContainer.classList.add(`md-smooth${e?"-pc":""}`),scrollImg(++nowIndex),1!==urlLength&&urlLength-1<=nowIndex)){const e=mediaViewer.querySelector('div.md-button[md-jsaction="next"]');e&&e.classList.add("md-btnHide")}}function scrollImgPrev(e){if(1!==urlLength){const e=mediaViewer.querySelector('div.md-button[md-jsaction="next"]');e&&e.classList.remove("md-btnHide")}if(nowIndex>0&&(imgContainer.classList.remove(`md-smooth${e?"":"-pc"}`),imgContainer.classList.add(`md-smooth${e?"-pc":""}`),scrollImg(--nowIndex),1!==urlLength&&nowIndex<=0)){const e=mediaViewer.querySelector('div.md-button[md-jsaction="prev"]');e&&e.classList.add("md-btnHide")}}function getImage(e){const t=mediaViewer.querySelectorAll("img.md-img");return t&&t[e]?t[e]:null}function openDropdownMenu(){const e=mediaViewer.querySelector("ul.md-dropdown-menu");e&&e.classList.remove("md-closeMenu")}function closeDropdownMenu(){const e=mediaViewer.querySelector("ul.md-dropdown-menu");e&&e.classList.add("md-closeMenu")}document.body.addEventListener("click",e=>{const t=e.target,n=t.closest("div.media-preview"),i=t.closest("div.md-prf");if(!n&&!i)return;let a=[],o=0;try{if(n){const e=n.querySelectorAll('a[rel="mediaPreview"]');if(!e)return;if(1===e.length){let t;e[0].removeAttribute("href"),t=changeImgSize(t=e[0].children.length>0?e[0].children[0].src.match(/(https:.+format=.+)/)[1]:e[0].style.backgroundImage.match(/url\(\"(https:.+format=.+)\"\)/)[1],"large"),a.push(t)}else for(let n=0;n<e.length;n++){e[n].removeAttribute("href");let i=e[n].style.backgroundImage.match(/url\(\"(https:.+format=.+)\"\)/)[1];i=changeImgSize(i,"large"),a.push(i),e[n]===t&&(o=n)}}else if(i){let e;e=t.classList.contains("avatar")?t.src.replace(/(https:\/\/pbs.twimg.com\/profile_images\/\w+\/.{8})_[^\.]+\.(\w+)/,"$1.$2"):t.src.replace(/(https:\/\/pbs.twimg.com\/profile_banners\/\w+\/\w+)\/.+/,"$1"),a.push(e)}openImageViewer(a,o)}catch(e){}},{passive:!0});let tap_timeout,tap_tempPoint,flgMove,tapCount=0,nowScale=1;function fncTouchStart(e){if(e.target.closest(".md-button"))return;if(e.preventDefault(),closeDropdownMenu(),!(targetImg=getImage(nowIndex)))return;const t=e.touches;startPoint={x:t[0].pageX,y:t[0].pageY},movePoint=startPoint,startTime=new Date,cTranslate3d=getTranslate3d(imgContainer),iTranslate3d=getTranslate3d(targetImg),nowScale=parseFloat(targetImg.style.transform.match(/scale\(([^\)]+)\)/)[1]),tap_tempPoint||(tap_tempPoint=startPoint),tapCount?(Math.abs(tap_tempPoint.x-startPoint.x)<50&&Math.abs(tap_tempPoint.y-startPoint.y)<50&&(targetImg.classList.remove("md-dragging"),1===nowScale?(nowScale=2,targetImg.style.transform=`scale(${nowScale}) translate3d(0px, 0px, 0px)`):(nowScale=1,targetImg.style.transform=`scale(${nowScale}) translate3d(0px, 0px, 0px)`)),tapCount=0,tap_tempPoint=null):(tapCount++,tap_timeout&&clearTimeout(tap_timeout),tap_timeout=setTimeout(()=>{tapCount=0,tap_tempPoint=null},200))}function fncTouchMove(e){if(e.target.closest(".md-button"))return;if(e.preventDefault(),!imgContainer||!targetImg)return;const t=e.touches;if(1===t.length)if(movePoint={x:t[0].pageX,y:t[0].pageY},1===nowScale)swipeDir?swipeDir<0?((cTranslateX=cTranslate3d[0]+(movePoint.x-startPoint.x))>0&&(cTranslateX=0),maxTransX>cTranslateX&&(cTranslateX=maxTransX),imgContainer.style.transform=`translate3d(${cTranslateX}px, 0px, 0px)`):(mediaViewer.classList.add("md-swipeY"),cTranslateY=cTranslate3d[1]+(movePoint.y-startPoint.y),imgContainer.style.transform=`translate3d(${cTranslate3d[0]}px, ${cTranslateY}px, 0px)`):20<getDistance(startPoint,movePoint)&&(swipeDir=getDirection(startPoint,movePoint),imgContainer.classList.remove("md-smooth"),imgContainer.classList.remove("md-smooth-pc"));else{if(!iTranslate3d)return;flgMove||Math.abs(movePoint.x-startPoint.x)>=40&&Math.abs(movePoint.y-startPoint.y)>=40&&(flgMove=!0),flgMove&&(targetImg.classList.add("md-dragging"),iTranslateX=iTranslate3d[0]+(movePoint.x-startPoint.x)/nowScale,iTranslateY=iTranslate3d[1]+(movePoint.y-startPoint.y)/nowScale,targetImg.style.transform=`scale(${nowScale}) translate3d(${iTranslateX}px, ${iTranslateY}px, 0px)`)}}function fncTouchEnd(e){if(!e.target.closest(".md-button")){if(e.preventDefault(),1===nowScale){const e=new Date-startTime,t=Math.sqrt(getDistance(startPoint,movePoint))/(e/1e3);if(e<200&&t>700)swipeDir<0?-2===swipeDir?scrollImgNext(!1):scrollImgPrev(!1):(mediaViewer.classList.add("md-swipeY"),imgContainer.classList.remove("md-smooth-pc"),imgContainer.classList.add("md-smooth"),imgContainer.style.transform=1===swipeDir?`translate3d(${cTranslate3d[0]}px, ${-1*window.innerHeight}px, 0px)`:`translate3d(${cTranslate3d[0]}px, ${window.innerHeight}px, 0px)`,setTimeout(closeImageViewer,200));else if(swipeDir<0){const e=.5*window.innerWidth,t=-1*window.innerWidth;for(let n=1;n<=urlLength;n++){nowIndex=n-1;const i=t*n+e;if(i<cTranslateX){imgContainer.classList.remove("md-smooth-pc"),imgContainer.classList.add("md-smooth"),imgContainer.style.transform=`translate3d(${i+e}px, 0px, 0px)`;break}}}else if(swipeDir>0){imgContainer.classList.remove("md-smooth-pc"),imgContainer.classList.add("md-smooth");const e=.5*window.innerHeight;-1*e<cTranslateY&&cTranslateY<e?(mediaViewer.classList.remove("md-swipeY"),imgContainer.style.transform=`translate3d(${cTranslate3d[0]}px, 0px, 0px)`):(imgContainer.style.transform=e<=cTranslateY?`translate3d(${cTranslate3d[0]}px, ${window.innerHeight}px, 0px)`:`translate3d(${cTranslate3d[0]}px, ${-1*window.innerHeight}px, 0px)`,setTimeout(closeImageViewer,200))}}movePoint=null,startPoint=null,startTime=null,swipeDir=null,cTranslate3d=null,iTranslate3d=null,flgMove=!1}}function fncClick(e){e.preventDefault(),closeDropdownMenu();const t=e.target.closest(".md-button");if(t)switch(t.getAttribute("md-jsaction")){case"menu":openDropdownMenu();break;case"save":const e=getImage(nowIndex);e&&e.getAttribute("src")&&console.log(`download:${e.getAttribute("src")}`);break;case"next":1===nowScale&&scrollImgNext(!0);break;case"prev":1===nowScale&&scrollImgPrev(!0);break;case"close":closeImageViewer()}}function fncWheel(e){if(!(targetImg=getImage(nowIndex)))return;e.clientX,e.clientY;if(targetImg.classList.contains("md-img")){if(nowScale=parseFloat(targetImg.style.transform.match(/scale\(([^\)]+)\)/)[1]),e.wheelDeltaY>0){const e=nowScale+.2;nowScale=e<=5?e:5,targetImg.style.transform=`scale(${nowScale}) translate3d(0px, 0px, 0px)`}else if(e.wheelDeltaY<0){const e=nowScale-.2;nowScale=e>=1?e:1,targetImg.style.transform=`scale(${nowScale}) translate3d(0px, 0px, 0px)`}if(1!==nowScale)return;e.wheelDeltaX>0?scrollImgPrev(!0):e.wheelDeltaX<0&&scrollImgNext(!0)}}document.body.addEventListener("keydown",e=>{if(mediaViewer&&"block"==mediaViewer.style.display){e.preventDefault();const t=e.key;if("c"===t&&closeImageViewer(),1!==nowScale)return;"ArrowRight"===t?scrollImgNext(!0):"ArrowLeft"===t?scrollImgPrev(!0):"ArrowUp"===t?(mediaViewer.classList.add("md-swipeY"),imgContainer.classList.remove("md-smooth"),imgContainer.classList.add("md-smooth-pc"),imgContainer.style.transform=`translate3d(${window.innerWidth*nowIndex*-1}px, ${-1*window.innerHeight-1}px, 0px)`,setTimeout(closeImageViewer,200)):"ArrowDown"===t&&(mediaViewer.classList.add("md-swipeY"),imgContainer.classList.remove("md-smooth"),imgContainer.classList.add("md-smooth-pc"),imgContainer.style.transform=`translate3d(${window.innerWidth*nowIndex*-1}px, ${window.innerHeight+1}px, 0px)`,setTimeout(closeImageViewer,200))}},{passive:!1});
