(()=>{function t(t){if(!t)return;const e=new Image,n=document.createElement("canvas"),s=n.getContext("2d"),i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=(t=>{const n=i.response;e.src=URL.createObjectURL(n)}),i.send();let o=[];e.addEventListener("load",()=>{n.width=3,n.height=3,s.drawImage(e,0,0,3,3);const t=s.getImageData(0,0,3,3).data;t.length;for(let e=0;e<3;e+=3)for(let n=0;n<12;n+=12){const s=n+12*e,i={r:t[s],g:t[s+1],b:t[s+2],a:t[s+3]/255},d={r:t[s+4],g:t[s+5],b:t[s+6],a:t[s+7]/255},a={r:t[s+8],g:t[s+9],b:t[s+10],a:t[s+11]/255},r={r:t[s+12+0],g:t[s+12+1],b:t[s+12+2],a:t[s+12+3]/255},m={r:t[s+12+4],g:t[s+12+5],b:t[s+12+6],a:t[s+12+7]/255},l={r:t[s+12+8],g:t[s+12+9],b:t[s+12+10],a:t[s+12+11]/255},c={r:t[s+24+0],g:t[s+24+1],b:t[s+24+2],a:t[s+24+3]/255},p={r:t[s+24+4],g:t[s+24+5],b:t[s+24+6],a:t[s+24+7]/255},u={r:t[s+24+8],g:t[s+24+9],b:t[s+24+10],a:t[s+24+11]/255},h=Math.floor((i.r+d.r+a.r+r.r+m.r+l.r+c.r+p.r+u.r)/9),f=Math.floor((i.g+d.g+a.g+r.g+m.g+l.g+c.g+p.g+u.g)/9),g=Math.floor((i.b+d.b+a.b+r.b+m.b+l.b+c.b+p.b+u.b)/9),b=Math.floor((i.a+d.a+a.a+r.a+m.a+l.a+c.a+p.a+u.a)/9*100)/100;o.push({r:h,g:f,b:g,a:b})}const i=(t=>{const e=t.r,n=t.g,s=t.b,i=Math.max(e,n,s),o=Math.min(e,n,s);let d;return(d=i==o?0:e==i?(n-s)/(i-o)*60:n==i?(s-e)/(i-o)*60+120:(e-n)/(i-o)*60+240)<0&&(d+=360),Math.floor(d)})(o[0]),d=i<13?0:25,a=document.getElementById("md-media-viewer");a&&(a.style.backgroundColor=`hsla(${i}deg,${d}%,20%)`),n.remove(),e.remove()})}if(null===document.getElementById("md-ImgViewer-style")){const t=document.createElement("style");t.setAttribute("id","md-ImgViewer-style"),t.setAttribute("type","text/css"),t.innerHTML=".md-spinner{width:60px;height:60px;position:absolute;top:calc((100% - 60px)/ 2);left:calc((100% - 60px)/ 2);z-index:999}.md-spinner-b1,.md-spinner-b2{width:100%;height:100%;border-radius:50%;background-color:#fff;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:sk-bounce 2s infinite ease-in-out;animation:sk-bounce 2s infinite ease-in-out}.md-spinner-b2{-webkit-animation-delay:-1s;animation-delay:-1s}@-webkit-keyframes sk-bounce{0%,100%{-webkit-transform:scale(0)}50%{-webkit-transform:scale(1)}}@keyframes sk-bounce{0%,100%{transform:scale(0);-webkit-transform:scale(0)}50%{transform:scale(1);-webkit-transform:scale(1)}}.md-spinner{display:none}.md-loadingImg+.md-spinner{display:block}#md-media-viewer{display:none;position:fixed;top:0;left:0;z-index:998;width:auto;height:100vh;margin:0!important;padding:0!important;background-color:#14171a;overflow:hidden;will-change:background;transition-property:background-color;transition-duration:.2s}#md-media-viewer.md-swipeY{background-color:#0000!important}.md-img-container,.md-media-container{width:100%;height:100%}.md-img-container{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;overflow:hidden;will-change:transform;transition-property:transform}.md-smooth{transition:.13s cubic-bezier(.4,0,.2,1)}.md-smooth-pc{transition:.5s cubic-bezier(.4,0,.2,1)}.md-swipeClose{transition:.2s cubic-bezier(.4,0,.2,1)}.md-img-item{position:relative;width:100vw;height:100%;min-width:100vw;min-height:100%;will-change:transform;transition:.2s}.md-img-item.md-dragging,.md-img-item.md-pinchInOut{transition:0s}.md-img{width:100%;height:100%;object-fit:contain;will-change:transform;transition:.2s}.md-img.md-dragging,.md-img.md-pinchInOut{transition:0s}.md-button{cursor:pointer}.md-btnCir{position:fixed;z-index:99;width:40px;height:40px;margin:0;padding:0;line-height:40px;text-align:center;background-color:#00000090;border-radius:50%;transition:.2s}.md-button[md-jsaction=menu]{display:none;top:13px;right:13px;transform:rotate(90deg)}.md-button[md-jsaction=next]{top:calc((100% - 40px)/ 2);right:13px}.md-button[md-jsaction=prev]{top:calc((100% - 40px)/ 2);left:13px}.md-button[md-jsaction=close]{top:13px;left:13px;background-color:#0000}.md-button[md-jsaction=close]:hover{background-color:#00000090}.md-button.md-btnHide{display:none!important}.md-btnCir>i{width:40px!important;height:40px!important;line-height:40px!important;font-size:30px!important;vertical-align:unset!important;color:#ffffffc4}.md-btnCir[md-jsaction=close]>i,.md-btnCir[md-jsaction=menu]>i{line-height:37px!important}.md-dropdown-menu{position:fixed;top:13px;right:13px;z-index:100;width:140px;border-radius:7px;overflow:hidden;will-change:width,height;transition:.2s}html .md-dropdown-menu{background-color:#fff;box-shadow:0 1px 7px -1px #00000050}html.dark .md-dropdown-menu{background-color:#222;box-shadow:0 1px 7px -1px #000000a1}.md-dropdown-menu>li{width:100%;height:40px;line-height:40px;text-align:center;margin:5px 0!important;user-select:none;cursor:pointer;transition:.3s}html .md-dropdown-menu>li{color:#333}html.dark .md-dropdown-menu>li{color:#fff}html .md-dropdown-menu>li:active{background-color:#00000013}html.dark .md-dropdown-menu>li:active{background-color:#ffffff13}.md-closeMenu,.md-swipeY .md-dropdown-menu{width:0;height:0}.md-ua-smp .md-button[md-jsaction=menu]{display:block}.md-ua-smp .md-button[md-jsaction=close],.md-ua-smp .md-button[md-jsaction=next],.md-ua-smp .md-button[md-jsaction=prev]{display:none}",document.head.appendChild(t)}let e,n,s,i,o,d,a,r,m,l,c,p,u,h,f,g=1;function b(i,o){if(0===(g=i.length))return;for(f=window.innerWidth*(g-1)*-1,s=o,(e=document.getElementById("md-media-viewer"))||(e=function(){if(!document.getElementById("md-media-viewer")){const t=document.createElement("div");return t.setAttribute("id","md-media-viewer"),t.setAttribute("style","display: none;"),t.insertAdjacentHTML("beforeend",'<div class="md-media-container"><div class="md-img-container"></div></div><div class="md-button-container"><div class="md-button md-btnCir" md-jsaction="menu"><i class="icon icon-more"></i></div><ul class="md-dropdown-menu md-closeMenu"><li class="md-button md-btnSqr" md-jsaction="save">保存</li><li class="md-button md-btnSqr md-hiddenfnc" md-jsaction="save-all">一括保存</li><li class="md-button md-btnSqr md-hiddenfnc" md-jsaction="share">共有</li></ul><div class="md-button md-btnCir" md-jsaction="next"><i class="icon icon-arrow-r"></i></div><div class="md-button md-btnCir" md-jsaction="prev"><i class="icon icon-arrow-l"></i></div><div class="md-button md-btnCir" md-jsaction="close"><i class="icon icon-close"></i></div></div>'),t.addEventListener("click",D,{passive:!1}),t.addEventListener("wheel",T,{passive:!1}),t.addEventListener("mousedown",z,{passive:!1}),t.addEventListener("touchstart",q,{passive:!1}),t.addEventListener("touchmove",S,{passive:!1}),t.addEventListener("touchend",Y,{passive:!1}),document.body.appendChild(t)}}()),navigator.userAgent.match(/(iPhone|iPad|iPod|Android)/i)?e.classList.add("md-ua-smp"):e.classList.remove("md-ua-smp"),n=e.querySelector("div.md-img-container");n.firstChild;)n.removeChild(n.firstChild);for(let t=0;t<g;t++){const e=document.createElement("img");e.classList.add("md-img","md-loadingImg"),e.style.transform="scale(1) translate3d(0px, 0px, 0px)",e.src=i[t],e.addEventListener("load",t=>{t.target.classList.remove("md-loadingImg")});const s=document.createElement("div");s.classList.add("md-img-item"),s.appendChild(e),s.insertAdjacentHTML("beforeend",'<div class="md-spinner"><div class="md-spinner-b1"></div><div class="md-spinner-b2"></div></div>'),n.appendChild(s)}t(i[o]);const d=window.innerWidth*o*-1;n.style.transform=`translate3d(${d}px, 0px, 0px)`;const a=e.querySelector('div.md-button[md-jsaction="next"]'),r=e.querySelector('div.md-button[md-jsaction="prev"]');a&&r&&(a.classList.remove("md-btnHide"),r.classList.remove("md-btnHide"),g<=1?(a.classList.add("md-btnHide"),r.classList.add("md-btnHide")):o<=0?r.classList.add("md-btnHide"):g-1<=o&&a.classList.add("md-btnHide")),"block"!==document.getElementById("open-modal").style.display&&setTimeout(()=>{const t=document.getElementById("open-modal");for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none"},0),e.style.display="block"}function x(){const t=document.getElementById("md-media-viewer");if(!t)return;t.style.display="none",t.style.backgroundColor="#14171a",t.classList.remove("md-swipeY");const n=t.querySelector(".md-img-container");if(!n)return;for(;n.firstChild;)n.removeChild(n.firstChild);t.classList.remove("md-swipeY");const s=e.querySelector("ul.md-dropdown-menu");s&&s.classList.add("md-closeMenu")}function w(t,e){if(t&&e)return t.replace(/&name=.+/,`&name=${e}`)}function v(t){try{let e=t.style.transform.match(/[-|\d|\.]+px/g);if(e){for(let t=0;t<e.length;t++)e[t]=parseFloat(e[t].replace("px",""));return e}}catch(t){}}function y(t,e){const n=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y);return n*n+s*s}function L(e){if(1!==I)return;const s=j(e);s&&s.src&&t(s.src);const i=window.innerWidth*e*-1;n.style.transform=`translate3d(${i}px, 0px, 0px)`,m=[i,0,0]}function k(t){if(1===I){if(1!==g){const t=e.querySelector('div.md-button[md-jsaction="prev"]');t&&t.classList.remove("md-btnHide")}if(s<g-1&&(n.classList.remove(`md-smooth${t?"":"-pc"}`),n.classList.add(`md-smooth${t?"-pc":""}`),L(++s),1!==g&&g-1<=s)){const t=e.querySelector('div.md-button[md-jsaction="next"]');t&&t.classList.add("md-btnHide")}}}function $(t){if(1===I){if(1!==g){const t=e.querySelector('div.md-button[md-jsaction="next"]');t&&t.classList.remove("md-btnHide")}if(s>0&&(n.classList.remove(`md-smooth${t?"":"-pc"}`),n.classList.add(`md-smooth${t?"-pc":""}`),L(--s),1!==g&&s<=0)){const t=e.querySelector('div.md-button[md-jsaction="prev"]');t&&t.classList.add("md-btnHide")}}}function j(t){const n=e.querySelectorAll("img.md-img");return t>=0?n&&n[t]?n[t]:null:n||null}function C(){const t=e.querySelector("ul.md-dropdown-menu");t&&t.classList.add("md-closeMenu")}document.body.addEventListener("click",t=>{const e=t.target,n=e.closest("div.media-preview"),s=e.closest("div.md-prf");if(!n&&!s)return;let i=[],o=0;try{if(n){const t=n.querySelectorAll('a[rel="mediaPreview"]');if(!t)return;if(1===t.length){let e;t[0].removeAttribute("href"),e=w(e=t[0].children.length>0?t[0].children[0].src.match(/(https:.+format=.+)/)[1]:t[0].style.backgroundImage.match(/url\(\"(https:.+format=.+)\"\)/)[1],"large"),i.push(e)}else for(let n=0;n<t.length;n++){t[n].removeAttribute("href");let s=t[n].style.backgroundImage.match(/url\(\"(https:.+format=.+)\"\)/)[1];s=w(s,"large"),i.push(s),t[n]===e&&(o=n)}}else if(s){let t;t=e.classList.contains("avatar")?e.src.replace(/(https:\/\/pbs.twimg.com\/profile_images\/\w+\/.{8})_[^\.]+\.(\w+)/,"$1.$2"):e.src.replace(/(https:\/\/pbs.twimg.com\/profile_banners\/\w+\/\w+)\/.+/,"$1"),i.push(t)}b(i,o)}catch(t){}},{passive:!0});let M,A,E,H=0,I=1;function q(t){if(t.target.closest(".md-button"))return;if(t.preventDefault(),C(),!(i=j(s)))return;const e=t.touches;o={x:e[0].pageX,y:e[0].pageY},a=o,d=new Date,m=v(n),l=v(i),I=parseFloat(i.style.transform.match(/scale\(([^\)]+)\)/)[1]),A||(A=o),H?(Math.abs(A.x-o.x)<50&&Math.abs(A.y-o.y)<50&&(i.classList.remove("md-dragging"),1===I?(I=2,i.style.transform=`scale(${I}) translate3d(0px, 0px, 0px)`):(I=1,i.style.transform=`scale(${I}) translate3d(0px, 0px, 0px)`)),H=0,A=null):(H++,M&&clearTimeout(M),M=setTimeout(()=>{H=0,A=null},200))}function S(t){if(t.target.closest(".md-button"))return;if(t.preventDefault(),!n||!i)return;const s=t.touches;if(1===s.length)if(a={x:s[0].pageX,y:s[0].pageY},1===I)r?r<0?((c=m[0]+(a.x-o.x))>0&&(c=0),f>c&&(c=f),n.style.transform=`translate3d(${c}px, 0px, 0px)`):(e.classList.add("md-swipeY"),p=m[1]+(a.y-o.y),n.style.transform=`translate3d(${m[0]}px, ${p}px, 0px)`):20<y(o,a)&&(r=function(t,e){const n=t.x,s=t.y,i=e.x,o=e.y;return Math.abs(o-s)<=Math.abs(i-n)?n<i?-1:-2:s<o?2:1}(o,a),n.classList.remove("md-smooth"),n.classList.remove("md-smooth-pc"));else{if(!l)return;E||Math.abs(a.x-o.x)>=5&&Math.abs(a.y-o.y)>=5&&(E=!0),E&&(i.classList.add("md-dragging"),u=l[0]+(a.x-o.x)/I,h=l[1]+(a.y-o.y)/I,i.style.transform=`scale(${I}) translate3d(${u}px, ${h}px, 0px)`)}}function Y(t){if(!t.target.closest(".md-button")){if(t.preventDefault(),1===I){const t=new Date-d,i=Math.sqrt(y(o,a))/(t/1e3);if(t<200&&i>700)r<0?-2===r?k(!1):$(!1):(e.classList.add("md-swipeY"),n.classList.remove("md-smooth-pc"),n.classList.add("md-smooth"),n.style.transform=1===r?`translate3d(${m[0]}px, ${-1*window.innerHeight}px, 0px)`:`translate3d(${m[0]}px, ${window.innerHeight}px, 0px)`,setTimeout(x,200));else if(r<0){const t=.5*window.innerWidth,e=-1*window.innerWidth;for(let i=1;i<=g;i++){s=i-1;const o=e*i+t;if(o<c){n.classList.remove("md-smooth-pc"),n.classList.add("md-smooth"),n.style.transform=`translate3d(${o+t}px, 0px, 0px)`;break}}}else if(r>0){n.classList.remove("md-smooth-pc"),n.classList.add("md-smooth");const t=.5*window.innerHeight;-1*t<p&&p<t?(e.classList.remove("md-swipeY"),n.style.transform=`translate3d(${m[0]}px, 0px, 0px)`):(n.style.transform=t<=p?`translate3d(${m[0]}px, ${window.innerHeight}px, 0px)`:`translate3d(${m[0]}px, ${-1*window.innerHeight}px, 0px)`,setTimeout(x,200))}}a=null,o=null,d=null,r=null,m=null,l=null,E=!1}}function D(t){t.preventDefault(),C();const n=t.target.closest(".md-button");if(n)switch(n.getAttribute("md-jsaction")){case"menu":!function(){const t=e.querySelector("ul.md-dropdown-menu");t&&t.classList.remove("md-closeMenu")}();break;case"save":{const t=j(s);t&&t.getAttribute("src")&&console.log(`download:${t.getAttribute("src")}`);break}case"save-all":{const t=j();if(t)for(let e of t)e&&e.getAttribute("src")&&console.log(`download:${e.getAttribute("src")}`);break}case"share":{const t=j(s);t&&t.getAttribute("src")&&console.log(`mdcmd:share(${t.getAttribute("src")})`);break}case"next":k(!0);break;case"prev":$(!0);break;case"close":x()}}function T(t){if(!(i=j(s)))return;t.clientX,t.clientY;if(i.classList.contains("md-img")){if(I=parseFloat(i.style.transform.match(/scale\(([^\)]+)\)/)[1]),t.wheelDeltaY>0){const t=I+.2;I=t<=5?t:5,i.style.transform=`scale(${I}) translate3d(0px, 0px, 0px)`}else if(t.wheelDeltaY<0){const t=I-.2;I=t>=1?t:1,i.style.transform=`scale(${I}) translate3d(0px, 0px, 0px)`}t.wheelDeltaX>0?$(!0):t.wheelDeltaX<0&&k(!0)}}function z(t){1===t.button&&x()}document.body.addEventListener("keydown",t=>{if(e&&"block"==e.style.display){t.preventDefault();const i=t.key;if("c"===i&&x(),1!==I)return;"ArrowRight"===i?k(!0):"ArrowLeft"===i?$(!0):"ArrowUp"===i?(e.classList.add("md-swipeY"),n.classList.remove("md-smooth"),n.classList.add("md-smooth-pc"),n.style.transform=`translate3d(${window.innerWidth*s*-1}px, ${-1*window.innerHeight-1}px, 0px)`,setTimeout(x,200)):"ArrowDown"===i&&(e.classList.add("md-swipeY"),n.classList.remove("md-smooth"),n.classList.add("md-smooth-pc"),n.style.transform=`translate3d(${window.innerWidth*s*-1}px, ${window.innerHeight+1}px, 0px)`,setTimeout(x,200))}},{passive:!1})})();
