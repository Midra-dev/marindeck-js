(()=>{let t;function e(t){if(!t)return;const e=document.createElement("canvas"),n=e.getContext("2d"),i=new Image;i.addEventListener("load",()=>{let t=[];e.width=3,e.height=3,n.drawImage(i,0,0,3,3);const s=n.getImageData(0,0,3,3).data;s.length;for(let e=0;e<3;e+=3)for(let n=0;n<12;n+=12){const i=n+12*e,o={r:s[i],g:s[i+1],b:s[i+2],a:s[i+3]/255},d={r:s[i+4],g:s[i+5],b:s[i+6],a:s[i+7]/255},r={r:s[i+8],g:s[i+9],b:s[i+10],a:s[i+11]/255},a={r:s[i+12+0],g:s[i+12+1],b:s[i+12+2],a:s[i+12+3]/255},m={r:s[i+12+4],g:s[i+12+5],b:s[i+12+6],a:s[i+12+7]/255},l={r:s[i+12+8],g:s[i+12+9],b:s[i+12+10],a:s[i+12+11]/255},c={r:s[i+24+0],g:s[i+24+1],b:s[i+24+2],a:s[i+24+3]/255},p={r:s[i+24+4],g:s[i+24+5],b:s[i+24+6],a:s[i+24+7]/255},u={r:s[i+24+8],g:s[i+24+9],b:s[i+24+10],a:s[i+24+11]/255},h=Math.floor((o.r+d.r+r.r+a.r+m.r+l.r+c.r+p.r+u.r)/9),f=Math.floor((o.g+d.g+r.g+a.g+m.g+l.g+c.g+p.g+u.g)/9),g=Math.floor((o.b+d.b+r.b+a.b+m.b+l.b+c.b+p.b+u.b)/9),b=Math.floor((o.a+d.a+r.a+a.a+m.a+l.a+c.a+p.a+u.a)/9*100)/100;t.push({r:h,g:f,b:g,a:b})}const o=(t=>{const e=t.r,n=t.g,i=t.b,s=Math.max(e,n,i),o=Math.min(e,n,i);let d;return(d=s==o?0:t.r==s?(t.g-t.b)/(s-o)*60:t.g==s?(t.b-t.r)/(s-o)*60+120:(t.r-t.g)/(s-o)*60+240)<0&&(d+=360),Math.floor(d)})(t[0]),d=o<13?0:25,r=document.getElementById("md-media-viewer");r&&(r.style.backgroundColor=`hsla(${o}deg,${d}%,20%)`),e.remove(),i.remove()}),i.src=t,i.crossOrigin="anonymous"}if(null===document.getElementById("md-ImgViewer-style")){const t=document.createElement("style");t.setAttribute("id","md-ImgViewer-style"),t.setAttribute("type","text/css"),t.innerHTML=".md-spinner{width:60px;height:60px;position:absolute;top:calc((100% - 60px)/ 2);left:calc((100% - 60px)/ 2);z-index:999}.md-spinner-b1,.md-spinner-b2{width:100%;height:100%;border-radius:50%;background-color:#fff;opacity:.6;position:absolute;top:0;left:0;-webkit-animation:sk-bounce 2s infinite ease-in-out;animation:sk-bounce 2s infinite ease-in-out}.md-spinner-b2{-webkit-animation-delay:-1s;animation-delay:-1s}@-webkit-keyframes sk-bounce{0%,100%{-webkit-transform:scale(0)}50%{-webkit-transform:scale(1)}}@keyframes sk-bounce{0%,100%{transform:scale(0);-webkit-transform:scale(0)}50%{transform:scale(1);-webkit-transform:scale(1)}}.md-spinner{display:none}.md-loadingImg+.md-spinner{display:block}#md-media-viewer{display:none;position:fixed;top:0;left:0;z-index:998;width:auto;height:100vh;margin:0!important;padding:0!important;background-color:#14171a;overflow:hidden;will-change:background;transition-property:background-color;transition-duration:.2s}#md-media-viewer.md-swipeY{background-color:#0000!important}.md-img-container,.md-media-container{width:100%;height:100%}.md-img-container{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;overflow:hidden;will-change:transform;transition-property:transform}.md-smooth{transition:.13s cubic-bezier(.4,0,.2,1)}.md-smooth-pc{transition:.5s cubic-bezier(.4,0,.2,1)}.md-swipeClose{transition:.2s cubic-bezier(.4,0,.2,1)}.md-img-item{position:relative;width:100vw;height:100%;min-width:100vw;min-height:100%;will-change:transform;transition:.2s}.md-img-item.md-dragging,.md-img-item.md-pinchInOut{transition:0s}.md-img{width:100%;height:100%;object-fit:contain;will-change:transform;transition:.2s}.md-img.md-dragging,.md-img.md-pinchInOut{transition:0s}.md-button{cursor:pointer}.md-btnCir{position:fixed;z-index:99;width:40px;height:40px;margin:0;padding:0;line-height:40px;text-align:center;background-color:#00000090;border-radius:50%;transition:.2s}.md-button[md-jsaction=menu]{display:none;top:13px;right:13px;transform:rotate(90deg)}.md-button[md-jsaction=next]{top:calc((100% - 40px)/ 2);right:13px}.md-button[md-jsaction=prev]{top:calc((100% - 40px)/ 2);left:13px}.md-button[md-jsaction=close]{top:13px;left:13px;background-color:#0000}.md-button[md-jsaction=close]:hover{background-color:#00000090}.md-button.md-btnHide{display:none!important}.md-btnCir>i{width:40px!important;height:40px!important;line-height:40px!important;font-size:30px!important;vertical-align:unset!important;color:#ffffffc4}.md-btnCir[md-jsaction=close]>i,.md-btnCir[md-jsaction=menu]>i{line-height:37px!important}.md-dropdown-menu{position:fixed;top:13px;right:13px;z-index:100;width:140px;border-radius:7px;overflow:hidden;will-change:width,height;transition:.2s}html .md-dropdown-menu{background-color:#fff;box-shadow:0 1px 7px -1px #00000050}html.dark .md-dropdown-menu{background-color:#222;box-shadow:0 1px 7px -1px #000000a1}.md-dropdown-menu>li{width:100%;height:40px;line-height:40px;text-align:center;margin:5px 0!important;user-select:none;cursor:pointer;transition:.3s}html .md-dropdown-menu>li{color:#333}html.dark .md-dropdown-menu>li{color:#fff}html .md-dropdown-menu>li:active{background-color:#00000013}html.dark .md-dropdown-menu>li:active{background-color:#ffffff13}.md-closeMenu,.md-swipeY .md-dropdown-menu{width:0;height:0}.md-ua-smp .md-button[md-jsaction=menu]{display:block}.md-ua-smp .md-button[md-jsaction=close],.md-ua-smp .md-button[md-jsaction=next],.md-ua-smp .md-button[md-jsaction=prev]{display:none}",document.head.appendChild(t)}let n,i,s,o,d,r,a,m,l,c,p,u,h,f,g=1;function b(s,o){if(0===(g=s.length))return;for(e(s[o]),f=window.innerWidth*(g-1)*-1,i=o,(t=document.getElementById("md-media-viewer"))||(t=function(){if(!document.getElementById("md-media-viewer")){const t=document.createElement("div");return t.setAttribute("id","md-media-viewer"),t.setAttribute("style","display: none;"),t.insertAdjacentHTML("beforeend",'<div class="md-media-container"><div class="md-img-container"></div></div><div class="md-button-container"><div class="md-button md-btnCir" md-jsaction="menu"><i class="icon icon-more"></i></div><ul class="md-dropdown-menu md-closeMenu"><li class="md-button md-btnSqr" md-jsaction="save">保存</li><li class="md-button md-btnSqr md-hiddenfnc" md-jsaction="save-all">一括保存</li><li class="md-button md-btnSqr md-hiddenfnc" md-jsaction="share">共有</li></ul><div class="md-button md-btnCir" md-jsaction="next"><i class="icon icon-arrow-r"></i></div><div class="md-button md-btnCir" md-jsaction="prev"><i class="icon icon-arrow-l"></i></div><div class="md-button md-btnCir" md-jsaction="close"><i class="icon icon-close"></i></div></div>'),t.addEventListener("click",D,{passive:!1}),t.addEventListener("wheel",T,{passive:!1}),t.addEventListener("mousedown",z,{passive:!1}),t.addEventListener("touchstart",q,{passive:!1}),t.addEventListener("touchmove",S,{passive:!1}),t.addEventListener("touchend",Y,{passive:!1}),document.body.appendChild(t)}}()),navigator.userAgent.match(/(iPhone|iPad|iPod|Android)/i)?t.classList.add("md-ua-smp"):t.classList.remove("md-ua-smp"),n=t.querySelector("div.md-img-container");n.firstChild;)n.removeChild(n.firstChild);for(let t=0;t<g;t++){const e=document.createElement("img");e.classList.add("md-img","md-loadingImg"),e.style.transform="scale(1) translate3d(0px, 0px, 0px)",e.src=s[t],e.addEventListener("load",t=>{t.target.classList.remove("md-loadingImg")});const i=document.createElement("div");i.classList.add("md-img-item"),i.appendChild(e),i.insertAdjacentHTML("beforeend",'<div class="md-spinner"><div class="md-spinner-b1"></div><div class="md-spinner-b2"></div></div>'),n.appendChild(i)}const d=window.innerWidth*o*-1;n.style.transform=`translate3d(${d}px, 0px, 0px)`;const r=t.querySelector('div.md-button[md-jsaction="next"]'),a=t.querySelector('div.md-button[md-jsaction="prev"]');r&&a&&(r.classList.remove("md-btnHide"),a.classList.remove("md-btnHide"),g<=1?(r.classList.add("md-btnHide"),a.classList.add("md-btnHide")):o<=0?a.classList.add("md-btnHide"):g-1<=o&&r.classList.add("md-btnHide")),"block"!==document.getElementById("open-modal").style.display&&setTimeout(()=>{const t=document.getElementById("open-modal");for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none"},0),t.style.display="block"}function x(){const e=document.getElementById("md-media-viewer");if(!e)return;e.style.display="none",e.style.backgroundColor="#14171a",e.classList.remove("md-swipeY");const n=e.querySelector(".md-img-container");if(!n)return;for(;n.firstChild;)n.removeChild(n.firstChild);e.classList.remove("md-swipeY");const i=t.querySelector("ul.md-dropdown-menu");i&&i.classList.add("md-closeMenu")}function w(t,e){if(t&&e)return t.replace(/&name=.+/,`&name=${e}`)}function v(t){try{let e=t.style.transform.match(/[-|\d|\.]+px/g);if(e){for(let t=0;t<e.length;t++)e[t]=parseFloat(e[t].replace("px",""));return e}}catch(t){}}function y(t,e){const n=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return n*n+i*i}function L(t){if(1!==I)return;const i=j(t);e(i?i.src:null);const s=window.innerWidth*t*-1;n.style.transform=`translate3d(${s}px, 0px, 0px)`,m=[s,0,0]}function k(e){if(1===I){if(1!==g){const e=t.querySelector('div.md-button[md-jsaction="prev"]');e&&e.classList.remove("md-btnHide")}if(i<g-1&&(n.classList.remove(`md-smooth${e?"":"-pc"}`),n.classList.add(`md-smooth${e?"-pc":""}`),L(++i),1!==g&&g-1<=i)){const e=t.querySelector('div.md-button[md-jsaction="next"]');e&&e.classList.add("md-btnHide")}}}function $(e){if(1===I){if(1!==g){const e=t.querySelector('div.md-button[md-jsaction="next"]');e&&e.classList.remove("md-btnHide")}if(i>0&&(n.classList.remove(`md-smooth${e?"":"-pc"}`),n.classList.add(`md-smooth${e?"-pc":""}`),L(--i),1!==g&&i<=0)){const e=t.querySelector('div.md-button[md-jsaction="prev"]');e&&e.classList.add("md-btnHide")}}}function j(e){const n=t.querySelectorAll("img.md-img");return e>=0?n&&n[e]?n[e]:null:n||null}function C(){const e=t.querySelector("ul.md-dropdown-menu");e&&e.classList.add("md-closeMenu")}document.body.addEventListener("click",t=>{const e=t.target,n=e.closest("div.media-preview"),i=e.closest("div.md-prf");if(!n&&!i)return;let s=[],o=0;try{if(n){const t=n.querySelectorAll('a[rel="mediaPreview"]');if(!t)return;if(1===t.length){let e;t[0].removeAttribute("href"),e=w(e=t[0].children.length>0?t[0].children[0].src.match(/(https:.+format=.+)/)[1]:t[0].style.backgroundImage.match(/url\(\"(https:.+format=.+)\"\)/)[1],"large"),s.push(e)}else for(let n=0;n<t.length;n++){t[n].removeAttribute("href");let i=t[n].style.backgroundImage.match(/url\(\"(https:.+format=.+)\"\)/)[1];i=w(i,"large"),s.push(i),t[n]===e&&(o=n)}}else if(i){let t;t=e.classList.contains("avatar")?e.src.replace(/(https:\/\/pbs.twimg.com\/profile_images\/\w+\/.{8})_[^\.]+\.(\w+)/,"$1.$2"):e.src.replace(/(https:\/\/pbs.twimg.com\/profile_banners\/\w+\/\w+)\/.+/,"$1"),s.push(t)}b(s,o)}catch(t){}},{passive:!0});let M,A,E,H=0,I=1;function q(t){if(t.target.closest(".md-button"))return;if(t.preventDefault(),C(),!(s=j(i)))return;const e=t.touches;o={x:e[0].pageX,y:e[0].pageY},r=o,d=new Date,m=v(n),l=v(s),I=parseFloat(s.style.transform.match(/scale\(([^\)]+)\)/)[1]),A||(A=o),H?(Math.abs(A.x-o.x)<50&&Math.abs(A.y-o.y)<50&&(s.classList.remove("md-dragging"),1===I?(I=2,s.style.transform=`scale(${I}) translate3d(0px, 0px, 0px)`):(I=1,s.style.transform=`scale(${I}) translate3d(0px, 0px, 0px)`)),H=0,A=null):(H++,M&&clearTimeout(M),M=setTimeout(()=>{H=0,A=null},200))}function S(e){if(e.target.closest(".md-button"))return;if(e.preventDefault(),!n||!s)return;const i=e.touches;if(1===i.length)if(r={x:i[0].pageX,y:i[0].pageY},1===I)a?a<0?((c=m[0]+(r.x-o.x))>0&&(c=0),f>c&&(c=f),n.style.transform=`translate3d(${c}px, 0px, 0px)`):(t.classList.add("md-swipeY"),p=m[1]+(r.y-o.y),n.style.transform=`translate3d(${m[0]}px, ${p}px, 0px)`):20<y(o,r)&&(a=function(t,e){const n=t.x,i=t.y,s=e.x,o=e.y;return Math.abs(o-i)<=Math.abs(s-n)?n<s?-1:-2:i<o?2:1}(o,r),n.classList.remove("md-smooth"),n.classList.remove("md-smooth-pc"));else{if(!l)return;E||Math.abs(r.x-o.x)>=5&&Math.abs(r.y-o.y)>=5&&(E=!0),E&&(s.classList.add("md-dragging"),u=l[0]+(r.x-o.x)/I,h=l[1]+(r.y-o.y)/I,s.style.transform=`scale(${I}) translate3d(${u}px, ${h}px, 0px)`)}}function Y(e){if(!e.target.closest(".md-button")){if(e.preventDefault(),1===I){const e=new Date-d,s=Math.sqrt(y(o,r))/(e/1e3);if(e<200&&s>700)a<0?-2===a?k(!1):$(!1):(t.classList.add("md-swipeY"),n.classList.remove("md-smooth-pc"),n.classList.add("md-smooth"),n.style.transform=1===a?`translate3d(${m[0]}px, ${-1*window.innerHeight}px, 0px)`:`translate3d(${m[0]}px, ${window.innerHeight}px, 0px)`,setTimeout(x,200));else if(a<0){const t=.5*window.innerWidth,e=-1*window.innerWidth;for(let s=1;s<=g;s++){i=s-1;const o=e*s+t;if(o<c){n.classList.remove("md-smooth-pc"),n.classList.add("md-smooth"),n.style.transform=`translate3d(${o+t}px, 0px, 0px)`;break}}}else if(a>0){n.classList.remove("md-smooth-pc"),n.classList.add("md-smooth");const e=.5*window.innerHeight;-1*e<p&&p<e?(t.classList.remove("md-swipeY"),n.style.transform=`translate3d(${m[0]}px, 0px, 0px)`):(n.style.transform=e<=p?`translate3d(${m[0]}px, ${window.innerHeight}px, 0px)`:`translate3d(${m[0]}px, ${-1*window.innerHeight}px, 0px)`,setTimeout(x,200))}}r=null,o=null,d=null,a=null,m=null,l=null,E=!1}}function D(e){e.preventDefault(),C();const n=e.target.closest(".md-button");if(n)switch(n.getAttribute("md-jsaction")){case"menu":!function(){const e=t.querySelector("ul.md-dropdown-menu");e&&e.classList.remove("md-closeMenu")}();break;case"save":{const t=j(i);t&&t.getAttribute("src")&&console.log(`download:${t.getAttribute("src")}`);break}case"save-all":{const t=j();if(t)for(let e of t)e&&e.getAttribute("src")&&console.log(`download:${e.getAttribute("src")}`);break}case"share":{const t=j(i);t&&t.getAttribute("src")&&console.log(`mdcmd:share(${t.getAttribute("src")})`);break}case"next":k(!0);break;case"prev":$(!0);break;case"close":x()}}function T(t){if(!(s=j(i)))return;t.clientX,t.clientY;if(s.classList.contains("md-img")){if(I=parseFloat(s.style.transform.match(/scale\(([^\)]+)\)/)[1]),t.wheelDeltaY>0){const t=I+.2;I=t<=5?t:5,s.style.transform=`scale(${I}) translate3d(0px, 0px, 0px)`}else if(t.wheelDeltaY<0){const t=I-.2;I=t>=1?t:1,s.style.transform=`scale(${I}) translate3d(0px, 0px, 0px)`}t.wheelDeltaX>0?$(!0):t.wheelDeltaX<0&&k(!0)}}function z(t){1===t.button&&x()}document.body.addEventListener("keydown",e=>{if(t&&"block"==t.style.display){e.preventDefault();const s=e.key;if("c"===s&&x(),1!==I)return;"ArrowRight"===s?k(!0):"ArrowLeft"===s?$(!0):"ArrowUp"===s?(t.classList.add("md-swipeY"),n.classList.remove("md-smooth"),n.classList.add("md-smooth-pc"),n.style.transform=`translate3d(${window.innerWidth*i*-1}px, ${-1*window.innerHeight-1}px, 0px)`,setTimeout(x,200)):"ArrowDown"===s&&(t.classList.add("md-swipeY"),n.classList.remove("md-smooth"),n.classList.add("md-smooth-pc"),n.style.transform=`translate3d(${window.innerWidth*i*-1}px, ${window.innerHeight+1}px, 0px)`,setTimeout(x,200))}},{passive:!1})})();
